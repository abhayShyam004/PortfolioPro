{% comment %}
Dynamic Favicon - Include this in the <head> section of all theme templates
Usage: {% include 'app/includes/dynamic_favicon.html' %}
{% endcomment %}

<!-- Dynamic Favicon -->
<link rel="icon" id="dynamic-favicon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><circle cx='16' cy='16' r='16' fill='%236366f1'/><text x='16' y='22' text-anchor='middle' font-family='Arial,sans-serif' font-size='14' font-weight='bold' fill='white'>AB</text></svg>">
<script>
(function() {
    const initials = '{{ settings.favicon_initials|default:""|escapejs }}'.toUpperCase().slice(0, 3) || '';
    const design = '{{ settings.favicon_design|default:"circle" }}';
    const bgColor = '{{ settings.favicon_bg_color|default:"#6366f1" }}';
    const textColor = '{{ settings.favicon_text_color|default:"#ffffff" }}';
    const secondaryColor = '{{ settings.secondary_color|default:"#23967f" }}';
    
    if (!initials) return; // No favicon if no initials set
    
    let svg = '';
    const fontSize = initials.length > 2 ? '10' : '14';
    
    if (design === 'circle') {
        svg = `<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><circle cx='16' cy='16' r='16' fill='${bgColor}'/><text x='16' y='22' text-anchor='middle' font-family='Arial,sans-serif' font-size='${fontSize}' font-weight='bold' fill='${textColor}'>${initials}</text></svg>`;
    } else if (design === 'rounded') {
        svg = `<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect width='32' height='32' rx='6' fill='${bgColor}'/><text x='16' y='22' text-anchor='middle' font-family='Arial,sans-serif' font-size='${fontSize}' font-weight='bold' fill='${textColor}'>${initials}</text></svg>`;
    } else if (design === 'square') {
        svg = `<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect width='32' height='32' fill='${bgColor}'/><text x='16' y='22' text-anchor='middle' font-family='Arial,sans-serif' font-size='${fontSize}' font-weight='bold' fill='${textColor}'>${initials}</text></svg>`;
    } else if (design === 'gradient') {
        svg = `<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><defs><linearGradient id='grad' x1='0%' y1='0%' x2='100%' y2='100%'><stop offset='0%' style='stop-color:${bgColor}'/><stop offset='100%' style='stop-color:${secondaryColor}'/></linearGradient></defs><circle cx='16' cy='16' r='16' fill='url(%23grad)'/><text x='16' y='22' text-anchor='middle' font-family='Arial,sans-serif' font-size='${fontSize}' font-weight='bold' fill='${textColor}'>${initials}</text></svg>`;
    } else if (design === 'outline') {
        svg = `<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><circle cx='16' cy='16' r='14' fill='none' stroke='${bgColor}' stroke-width='3'/><text x='16' y='22' text-anchor='middle' font-family='Arial,sans-serif' font-size='${fontSize}' font-weight='bold' fill='${bgColor}'>${initials}</text></svg>`;
    }
    
    if (svg) {
        const encoded = 'data:image/svg+xml,' + encodeURIComponent(svg);
        const link = document.getElementById('dynamic-favicon');
        if (link) link.href = encoded;
    }
})();
</script>
